# 🎨 背景移除工具 (Background Removal Tool)

一個基於 Python 和 PyQt5 的智能背景移除工具，使用顏色分析和機器學習技術來精確移除圖片背景。

## ✨ 主要功能

### 🎯 核心功能
- **智能背景移除**: 基於顏色相似度分析的精確背景移除
- **多通道分析**: 支援 RGB、HSV、LAB 等多種顏色空間
- **即時預覽**: 實時查看處理效果，無需等待
- **參數調整**: 直觀的滑桿控制，精細調整處理參數

### 🖼️ 多種檢視模式
- **原始圖片**: 正常顯示、高斯模糊
- **處理結果**: 正常顯示、Alpha 混合、圖層疊加、高斯模糊
- **透明背景**: 經典黑白方格透明背景顯示

### ⚡ 高效處理
- **Numba 加速**: 使用 JIT 編譯大幅提升處理速度
- **批量處理**: 支援資料夾批量處理，節省時間
- **背景執行**: 處理過程不阻塞介面操作

### 🛠️ 進階功能
- **雜點移除**: 智能移除小面積雜點，提升結果品質
- **邊緣處理**: 支援擴張和侵蝕操作，精細調整邊緣效果
- **參數儲存**: 儲存和載入處理參數，方便重複使用
- **多格式支援**: 支援 PNG、JPG、JPEG、BMP 等常見格式

## 🚀 快速開始

### 系統需求
- Python 3.8+
- Windows 10/11 (主要測試平台)

### 安裝步驟

1. **下載專案**
```bash
git clone https://github.com/AkitaCodingPeasant/CVBackGroundRemover.git
cd BackgroundRemove
```

2. **建立虛擬環境**
```bash
python -m venv .venv
.venv\Scripts\activate  # Windows
```

3. **安裝依賴套件**
```bash
pip install -r requirements.txt
```

4. **執行程式**
```bash
python main.py
```

### 必要套件
```
PyQt5>=5.15.0
opencv-python>=4.5.0
numpy>=1.21.0
numba>=0.56.0
scikit-image>=0.19.0
```

## 📖 使用指南

### 基本操作流程

1. **載入圖片**: 點擊「匯入圖片」按鈕選擇要處理的圖片
2. **設定顏色**: 使用滴管工具選取前景色和背景色
3. **調整參數**: 
   - 選擇顏色通道 (RGB/HSV/LAB)
   - 調整前景/背景相似度閾值
   - 設定雜點移除面積（需點擊「套用去雜點」按鈕）
   - 設定邊緣處理參數（需點擊「套用邊緣處理」按鈕）
4. **即時預覽**: 在右側預覽視窗查看處理效果
5. **匯出結果**: 滿意後點擊「匯出圖片」儲存結果

### 進階功能使用

#### 🎛️ 參數調整技巧
- **前景閾值**: 控制保留區域的範圍，數值越高保留越多
- **背景閾值**: 控制移除區域的範圍，數值越高移除越多
- **雜點移除**: 設定最小保留面積，移除小雜點（需點擊「套用去雜點」按鈕）
- **邊緣擴張**: 在指定範圍內尋找最大像素值，用於擴展前景邊緣（需點擊「套用邊緣處理」按鈕）
- **邊緣侵蝕**: 在指定範圍內尋找最小像素值，用於收縮前景邊緣（需點擊「套用邊緣處理」按鈕）

#### 🔄 批量處理
1. 設定好單張圖片的處理參數
2. 點擊「批量處理」按鈕
3. 選擇包含多張圖片的資料夾
4. 確認參數設定後開始處理
5. 處理完成的圖片會儲存在 `原資料夾名-rmbg` 資料夾中

#### 💾 參數管理
- **儲存參數**: 將當前設定儲存為 JSON 檔案
- **載入參數**: 從 JSON 檔案載入之前的設定
- **預設參數**: 系統會記住上次使用的設定

## 🏗️ 專案架構

```
BackgroundRemove/
├── main.py                 # 主程式和 GUI 介面
├── color_analysis.py       # 顏色分析核心演算法
├── image_rendering.py      # 圖片渲染和效果處理
├── noise_removal.py        # 雜點移除演算法
├── batch_processing.py     # 批量處理功能
└── README.md               # 說明文件
```

### 模組說明

- **main.py**: PyQt5 使用者介面，處理所有使用者互動
- **color_analysis.py**: 實作顏色空間轉換和相似度計算
- **image_rendering.py**: 負責結果圖片生成和各種檢視模式
- **noise_removal.py**: 使用連通元件分析移除小面積雜點
- **batch_processing.py**: 多執行緒批量處理框架

## ⚙️ 演算法原理

### 顏色相似度分析
本工具使用多種距離度量來計算顏色相似度：
- **歐幾里得距離**: 在選定顏色空間中的直線距離
- **加權距離**: 考慮不同通道的重要性
- **餘弦相似度**: 基於向量角度的相似度計算

### 最佳化技術
- **Numba JIT**: 對核心計算函數使用即時編譯加速
- **向量化運算**: 使用 NumPy 向量化操作提升效能
- **記憶體最佳化**: 避免不必要的陣列複製

## 🎨 檢視模式說明

### 原始圖片檢視
- **正常**: 顯示原始圖片
- **高斯模糊**: 應用高斯模糊效果，可調整模糊程度

### 結果檢視
- **正常**: 顯示去背後的結果（透明背景）
- **Alpha 混合**: 與背景顏色混合顯示
- **圖層疊加**: 疊加在原始圖片上顯示差異
- **高斯模糊**: 對結果應用模糊效果

## 🔧 參數說明

| 參數 | 範圍 | 說明 |
|------|------|------|
| 顏色通道 | RGB/HSV/LAB | 分析使用的顏色空間 |
| 前景閾值 | 0-100% | 前景色相似度門檻 |
| 背景閾值 | 0-100% | 背景色相似度門檻 |
| 雜點面積 | 0-10000像素 | 最小保留區域面積 |
| 擴張大小 | 0-20像素 | 邊緣擴張操作的核心大小 |
| 侵蝕大小 | 0-20像素 | 邊緣侵蝕操作的核心大小 |
| 模糊核心 | 1-99 | 高斯模糊的核心大小 |
